<% content_for :title, "Showing workout" %>

<div class="md:w-2/3 w-full">
  <% if notice.present? %>
    <p class="py-2 px-3 bg-green-50 mb-5 text-green-500 font-medium rounded-md inline-block" id="notice"><%= notice %></p>
  <% end %>

  <div class="mb-6">
    <div class="flex justify-between items-center mb-4">
      <div>
        <h1 class="text-2xl font-bold"><%= @workout.name %></h1>
        <p class="text-gray-600"><%= @workout.date.strftime("%B %d, %Y") %></p>
      </div>
      
      <div class="flex space-x-2">
        <%= link_to "Edit Workout", edit_workout_path(@workout), class: "bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700" %>
        <%= link_to "Back to Workouts", workouts_path, class: "bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300" %>
      </div>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
      <div class="bg-white rounded-lg shadow p-4">
        <h2 class="text-lg font-semibold mb-2">Total Volume</h2>
        <p class="text-3xl font-bold text-indigo-600"><%= number_with_delimiter(@workout.total_volume) %> kg</p>
      </div>
      
      <div class="bg-white rounded-lg shadow p-4">
        <h2 class="text-lg font-semibold mb-2">Duration</h2>
        <p class="text-3xl font-bold text-indigo-600"><%= @workout.duration_minutes ? "#{@workout.duration_minutes} min" : "N/A" %></p>
      </div>
      
      <div class="bg-white rounded-lg shadow p-4">
        <h2 class="text-lg font-semibold mb-2">Exercises</h2>
        <p class="text-3xl font-bold text-indigo-600"><%= @exercise_logs.count %></p>
      </div>
    </div>
    
    <% if @workout.notes.present? %>
      <div class="bg-white rounded-lg shadow p-4 mb-6">
        <h2 class="text-lg font-semibold mb-2">Notes</h2>
        <p class="text-gray-700"><%= simple_format(@workout.notes) %></p>
      </div>
    <% end %>
    
    <div class="bg-white rounded-lg shadow overflow-hidden mb-6">
      <div class="flex justify-between items-center p-4 border-b">
        <h2 class="text-lg font-semibold">Exercises</h2>
        <%= link_to "Add Exercise", new_workout_exercise_log_path(@workout), class: "bg-indigo-600 text-white px-3 py-1 rounded text-sm hover:bg-indigo-700" %>
      </div>
      
      <% if @exercise_logs.any? %>
        <div id="exercise-logs">
          <% @exercise_logs.each do |log| %>
            <div id="<%= dom_id(log) %>" class="border-b last:border-b-0">
              <div class="p-4">
                <div class="flex justify-between items-center mb-2">
                  <h3 class="text-xl font-medium"><%= log.exercise.name %></h3>
                  <div class="flex space-x-2">
                    <%= link_to "Add Set", new_workout_exercise_log_exercise_set_path(@workout, log), class: "text-indigo-600 hover:text-indigo-800 text-sm" %>
                    <%= link_to "Edit", edit_workout_exercise_log_path(@workout, log), class: "text-indigo-600 hover:text-indigo-800 text-sm" %>
                    <%= button_to "Delete", workout_exercise_log_path(@workout, log), method: :delete, class: "text-red-600 hover:text-red-800 text-sm", form: { data: { turbo_confirm: "Are you sure?" } } %>
                  </div>
                </div>
                
                <div class="text-sm text-gray-600 mb-3">
                  <span class="mr-3"><%= log.exercise.category %></span>
                  <span><%= log.exercise.equipment_type %></span>
                  <% if log.equipment_brand.present? %>
                    <span class="ml-3">Brand: <%= log.equipment_brand %></span>
                  <% end %>
                </div>
                
                <% if log.notes.present? %>
                  <div class="bg-gray-50 p-3 rounded mb-3 text-sm">
                    <p class="font-medium mb-1">Notes:</p>
                    <%= simple_format(log.notes, class: "text-gray-700") %>
                  </div>
                <% end %>
                
                <div id="<%= dom_id(log, :sets) %>">
                  <% if log.sets.any? %>
                    <div class="overflow-x-auto">
                      <table class="min-w-full divide-y divide-gray-200">
                        <thead>
                          <tr>
                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Set</th>
                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Weight</th>
                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Reps</th>
                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Volume</th>
                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rest</th>
                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Duration</th>
                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Notes</th>
                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"></th>
                          </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                          <% log.sets.each do |set| %>
                            <tr id="<%= dom_id(set) %>" class="hover:bg-gray-50">
                              <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900"><%= set.set_number %></td>
                              <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900"><%= set.weight %> kg</td>
                              <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900"><%= set.reps %></td>
                              <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900"><%= set.volume %> kg</td>
                              <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-500"><%= set.rest_seconds ? "#{set.rest_seconds} sec" : "-" %></td>
                              <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-500"><%= set.duration_seconds ? "#{set.duration_seconds} sec" : "-" %></td>
                              <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-500"><%= set.notes.present? ? truncate(set.notes, length: 20) : "-" %></td>
                              <td class="px-3 py-2 whitespace-nowrap text-right text-sm font-medium">
                                <div class="flex space-x-2">
                                  <%= link_to "Edit", edit_workout_exercise_log_exercise_set_path(@workout, log, set), class: "text-indigo-600 hover:text-indigo-900" %>
                                  <%= button_to "Delete", workout_exercise_log_exercise_set_path(@workout, log, set), method: :delete, class: "text-red-600 hover:text-red-900", form: { data: { turbo_confirm: "Are you sure?" } } %>
                                </div>
                              </td>
                            </tr>
                          <% end %>
                        </tbody>
                      </table>
                    </div>
                  <% else %>
                    <div class="text-center py-4 text-gray-500">
                      <p>No sets recorded yet.</p>
                      <%= link_to "Add your first set", new_workout_exercise_log_exercise_set_path(@workout, log), class: "text-indigo-600 hover:text-indigo-800" %>
                    </div>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="text-center py-8 text-gray-500">
          <p class="mb-4">No exercises added to this workout yet.</p>
          <%= link_to "Add your first exercise", new_workout_exercise_log_path(@workout), class: "bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700" %>
        </div>
      <% end %>
    </div>
  </div>

  <%= render @workout %>

  <%= link_to "Edit this workout", edit_workout_path(@workout), class: "mt-2 rounded-md px-3.5 py-2.5 bg-gray-100 hover:bg-gray-50 inline-block font-medium" %>
  <%= link_to "Back to workouts", workouts_path, class: "ml-2 rounded-md px-3.5 py-2.5 bg-gray-100 hover:bg-gray-50 inline-block font-medium" %>
  <div class="inline-block ml-2">
    <%= button_to "Destroy this workout", @workout, method: :delete, class: "mt-2 rounded-md px-3.5 py-2.5 text-white bg-red-600 hover:bg-red-500 font-medium" %>
  </div>
</div>
