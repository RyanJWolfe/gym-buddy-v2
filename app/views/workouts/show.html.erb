<% content_for :title, @workout.name %>

<div class="max-w-2xl mx-auto">
  <div class="flex items-start justify-between mb-4">
    <div class="flex items-center space-x-1">
      <%= render "shared/buttons/back_button" %>
      <div class="flex flex-col">
        <h1 class="text-2xl font-extramedium"><%= @workout.name %></h1>
        <h2 class="text-sm text-muted"><%= @workout.start_time.strftime("%A, %b %d, %Y") %></h2>
      </div>
    </div>
    <div class="flex items-center space-x-2">
      <%= link_to "Edit", edit_workout_path(@workout), class: "btn btn-primary" %>
      <% content_for :trigger do %>
        <button type="button" class="btn btn-tertiary" data-action="dialog#open">
          <%= inline_svg_tag "icons/trash.svg", class: "w-5 h-5 text-danger" %>
        </button>
      <% end %>

      <%= render "layouts/active_workout_indicator/discard_workout_dialog",
                 workout: @workout,
                 trigger: :trigger,
                 title: "Delete Workout",
                 subtitle: "Are you sure you want to delete this workout?" %>
    </div>
  </div>

  <div class="flex flex-col gap-y-4">
    <div class="text-sm">
      <div class="flex items-center justify-evenly">
        <p class="flex flex-col items-center gap-y-1">
          <label class="text-muted font-medium">Start time</label>
          <%= @workout.start_time ? @workout.start_time.strftime("%l:%M %P") : "—" %>
        </p>

        <p class="flex flex-col items-center gap-y-1">
          <label class="text-muted font-medium">Duration</label>
          <%= format_duration_seconds(@workout.duration_seconds) %>
        </p>

        <p class="flex flex-col items-center gap-y-1"><label class="text-muted font-medium">Exercises</label> <%= @workout.exercise_logs.size %></p>
        <p class="flex flex-col items-center gap-y-1"><label class="text-muted font-medium">Sets</label> <%= @workout.total_sets %></p>
      </div>
    </div>


    <div>
      <h2 class="text-lg font-extramedium mb-3">Exercises</h2>

      <% if @workout.exercise_logs.any? %>
        <div class="space-y-4">
          <% @workout.exercise_logs.each do |log| %>
            <div class="border rounded p-4">
              <div class="flex items-center justify-between">
                <div class="font-semibold"><%= log.exercise&.name || "Unknown Exercise" %></div>
                <div class="text-sm text-gray-600"><%= pluralize(log.sets.size, "set") %></div>
              </div>

              <% if log.sets.any? %>
                <ul class="mt-2 space-y-1">
                  <% log.sets.each do |set| %>
                    <li class="flex justify-between text-sm">
                      <span>Set <%= set.set_number %></span>
                      <span>
                        <%= set.reps.present? ? "#{set.reps} reps" : "-" %>

                        <% if set.weight.present? %>
                          &nbsp;•&nbsp;<%= number_with_precision(set.weight, precision: 2) %>
                        <% end %>
                      </span>
                    </li>
                  <% end %>
                </ul>
              <% else %>
                <div class="text-sm text-gray-500 mt-2">No sets recorded</div>
              <% end %>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="text-sm text-gray-500">No exercises recorded for this workout.</div>
      <% end %>
    </div>
  </div>
</div>