<%# locals: ( f: ) %>

<div class="nested-form-wrapper border border-gray-300 rounded-lg p-4 bg-white shadow-sm" data-new-record="<%= f.object.new_record? %>">
  <div class="flex justify-between items-center mb-4">
    <div>
      <div data-nested-exercise-select-form-target="exerciseContainer">
        <% if f.object.exercise.present? %>
          <h5 class="font-semibold mb-2" data-nested-exercise-select-form-target="exerciseName"><%= f.object.exercise.name %></h5>
        <% end %>
      </div>
      <%= f.hidden_field :exercise_id, data: { nested_exercise_select_form_target: "exerciseFormField" } %>
    </div>

    <button type="button" data-action="click->nested-exercise-select-form#remove" class="text-red-600 hover:text-red-800">
      <%= inline_svg_tag "icons/trash.svg", class: "h-5 w-5" %>
    </button>
  </div>

  <div class="mt-4" data-controller="nested-form" data-nested-form-wrapper-selector-value=".sets-wrapper">
    <h5 class="font-semibold mb-2">Sets</h5>
    <div class="space-y-2">
      <%= f.fields_for :routine_sets do |set_fields| %>
        <%= render "routine_sets/form", f: set_fields %>
      <% end %>
    </div>
    <template data-nested-form-target="template">
      <%= f.fields_for :routine_sets, RoutineSet.new, child_index: "NEW_RECORD" do |set_fields| %>
        <%= render "routine_sets/form", f: set_fields %>
      <% end %>
    </template>
    <div class="mt-2">
      <button type="button" data-action="nested-form#add" data-nested-form-target="target" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
        Add Set
      </button>
    </div>
  </div>

  <%= f.hidden_field :_destroy %>
</div>