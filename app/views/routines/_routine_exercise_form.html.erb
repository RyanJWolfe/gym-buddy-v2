<%# locals: ( f: ) %>

<div class="nested-exercise-form-wrapper" data-new-record="<%= f.object.new_record? %>">
  <div class="flex justify-between items-center mb-4 mt-2">
    <div id="<%= f.object.exercise.present? ? dom_id(f.object.exercise) : "__exercise_dom_id__" %>">
      <div data-nested-exercise-select-form-target="exerciseContainer">
        <% if f.object.exercise.present? %>
          <h5 class="font-medium" data-nested-exercise-select-form-target="exerciseName"><%= f.object.exercise.name %></h5>
        <% end %>
      </div>
      <%= f.hidden_field :exercise_id, data: { nested_exercise_select_form_target: "exerciseFormField" } %>
    </div>


    <div data-controller="bottom-sheet">
      <button type="button" data-action="click->bottom-sheet#open" class="p-1 hover:bg-gray-200 rounded-lg">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path d="M6 10a2 2 0 11-4 0 2 2 0 014 0zM12 10a2 2 0 11-4 0 2 2 0 014 0zM16 12a2 2 0 100-4 2 2 0 000 4z"/>
        </svg>
      </button>

      <!-- Bottom Sheet -->
      <div data-bottom-sheet-target="sheet" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 z-50 transition-transform transform translate-y-full" data-action="click->bottom-sheet#close">
        <div data-bottom-sheet-target="content" class="absolute bottom-0 left-0 right-0 bg-white rounded-t-lg shadow-lg p-4" data-action="click->stop">
          <div class="flex justify-center mb-4">
            <div class="w-10 h-1 bg-gray-300 rounded-full"></div>
          </div>
          <div class="space-y-4">
            <%= link_to routine_exercise_select_modal_path(mode: :replace, target_dom_id: f.object.exercise.present? ? dom_id(f.object.exercise) : "__exercise_dom_id__" ), data: { turbo_method: :post }, class: "flex items-center gap-x-3 p-3 -mx-3 rounded-lg hover:bg-gray-100" do %>
              <%= inline_svg_tag "icons/rotate-cw.svg", class: "h-6 w-6" %>
              <span class="font-medium">Change exercise</span>
            <% end %>
            <button type="button" data-action="click->nested-exercise-select-form#remove click->bottom-sheet#close" class="w-full flex items-center gap-x-3 p-3 -mx-3 rounded-lg hover:bg-gray-100 text-red-600 hover:text-red-800">
              <%= inline_svg_tag "icons/trash.svg", class: "h-6 w-6" %>
              <span class="font-medium">Remove exercise</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="mt-4" data-controller="nested-set-form" data-nested-set-form-wrapper-selector-value=".sets-wrapper">
    <div class="grid grid-cols-12 mb-2">
      <label class="col-span-3 text-muted uppercase">set</label>
      <label class="col-span-3 text-muted uppercase">lbs</label>
      <label class="col-span-3 text-muted uppercase">reps</label>
    </div>
    <%= f.fields_for :routine_sets do |set_fields| %>
      <%= render "routine_sets/form", f: set_fields %>
    <% end %>
    <!--    TODO: move nested form target into above fields_for, may need to see what happens when an exercise has no sets, will above render target at all?-->
    <template data-nested-set-form-target="template">
      <%= f.fields_for :routine_sets, child_index: "NEW_SET_RECORD" do |set_fields| %>
        <%= render "routine_sets/form", f: set_fields %>
      <% end %>
    </template>
    <button type="button" data-action="nested-set-form#add" data-nested-set-form-target="target" class="mt-4 btn btn-icon btn-tertiary w-full">
      <%= inline_svg_tag "icons/plus.svg", class: "h-4 w-4" %>
      Add Set
    </button>
  </div>

  <%= f.hidden_field :_destroy %>
</div>